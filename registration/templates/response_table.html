{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SPAC 2025 | Registration Dashboard</title>
    <link rel="icon" href="{% static '/img/logo.gif' %}" />

    <!-- Tailwind & DaisyUI -->
    <script src="https://cdn.tailwindcss.com/3.4.17"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@5" rel="stylesheet" />

    <!-- Particles -->
    <script src="{% static 'js/particles.min.js' %}"></script>

    <style>
      #particles-js {
        position: fixed;
        inset: 0;
        background-color: #002855;
        z-index: -10;
      }
      tbody tr {
        transition: all 0.2s ease-in-out;
        cursor: pointer;
        text-align: center;
      }
      tbody tr:hover {
        background-color: #00285517;
      }
      .logout {
        background: #c22d2d85;
        color: white;
        padding: 8px 16px;
        border-radius: 6px;
        border: 2px solid #c22d2d;
      }
      .logout:hover {
        background: #c22d2d;
        transition: 0.3s;
      }
      input::placeholder {
        color: #ffffff;
      }
      input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }
    </style>
  </head>

  <body class="min-h-screen">
    <div id="particles-js"></div>

    <div class="relative w-11/12 max-w-7xl mx-auto py-10 z-10">
      <!-- Header -->
      <div class="relative mb-20">
        <div class="relative flex justify-center">
          <span
            class="px-10 py-3 text-[#fff] bg-[#002855] border-2 border-white text-3xl rounded-xl shadow-[2px_4px_0_0_#fff]"
          >
            Registration Dashboard
          </span>
        </div>
      </div>

      <!-- Controls -->
      <div class="flex justify-between max-md:flex-col-reverse flex-wrap max-md:gap-5 items-center mb-5">
        <input
          id="tableSearch"
          type="text"
          placeholder="Search by name or email"
          class="px-4 py-2 w-full max-md:mr-3 md:w-1/2 rounded-lg shadow-sm border-2 focus:border-[#ffffffab] focus:outline-none text-white"
        />

        <div class="flex items-center gap-4">
          <button
            id="sendMailBtn"
            class="px-5 py-2 bg-[#1b395c] text-white rounded-lg shadow hover:bg-[#00629B] border-2"
          >
            Send Phase-2 Email
          </button>
          <a href="{% url 'core:logout' %}" class="logout">Logout</a>
        </div>
      </div>

      <!-- Table -->
      <div class="bg-white rounded-xl shadow-lg overflow-x-auto max-h-[450px]">
        <table class="min-w-full text-sm">
          <thead class="sticky top-0 z-10">
            <tr class="bg-[#1b395c] text-white">
              <th class="px-4 py-3">ID</th>
              <th class="px-4 py-3">Name</th>
              <th class="px-4 py-3">University</th>
              <th class="px-4 py-3">Email</th>
              <th class="px-4 py-3">Select</th>
              <th class="px-4 py-3">Status</th>
            </tr>
          </thead>
          <tbody>
            {% for p in participants %}
            <tr
              class="border-b"
              data-href="{% url 'registration:view_response' p.id %}"
            >
            <td class="px-4 py-3">{{ p.id }}</td>
            <td class="px-4 py-3">{{ p.name }}</td>
            <td class="px-4 py-3">{{ p.university }}</td>
            <td class="px-4 py-3">{{ p.email }}</td>
            <td class="px-4 py-3">
              <input
                type="checkbox"
                class="phase2Check"
                data-id="{{p.id}}"
                {%
                if
                p.phase2_mail_sent
                %}disabled
                checked{%
                endif
                %}
              />
            </td>
              <td class="px-4 py-3">
                {% if p.phase2_mail_sent %}
                <span
                  class="px-3 py-1 text-xs bg-green-100 text-green-700 rounded-full"
                  >Email Sent</span
                >
                {% else %}
                <span
                  class="px-3 py-1 text-xs bg-yellow-100 text-yellow-700 rounded-full"
                  >Pending</span
                >
                {% endif %}
              </td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="6" class="text-center py-6 text-gray-500">
                No participants found
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Footer -->
      <div class="text-center mt-6 text-gray-200 text-sm italic">
        2025 Â© IEEE NSU Student Branch
      </div>
    </div>

    <!-- Scripts -->
    <script>
      // Search
      document
        .getElementById("tableSearch")
        .addEventListener("input", function () {
          const q = this.value.toLowerCase();
          document.querySelectorAll("tbody tr").forEach((row) => {
            const name = row.children[2]?.innerText.toLowerCase() || "";
            const email = row.children[4]?.innerText.toLowerCase() || "";
            row.style.display =
              name.includes(q) || email.includes(q) ? "" : "none";
          });
        });

      // Row click
      document.querySelectorAll("tbody tr").forEach((row) => {
        row.addEventListener("click", (e) => {
          if (e.target.type !== "checkbox") {
            const link = row.dataset.href;
            if (link) window.location.href = link;
          }
        });
      });

      // Send Mail Button (Frontend only)
      document.getElementById("sendMailBtn").addEventListener("click", () => {
        const selected = [
          ...document.querySelectorAll(".phase2Check:checked:not(:disabled)"),
        ].map((cb) => cb.dataset.id);

        if (!selected.length) {
          alert("No participants selected");
          return;
        }

        alert("Phase-2 emails will be sent to IDs: " + selected.join(", "));
        // Backend POST should be implemented here
      });

      // Particles
      particlesJS("particles-js", {
        particles: {
          number: { value: 40 },
          color: { value: "#fff" },
          size: { value: 3 },
          move: { speed: 1 },
        },
      });
    </script>
  </body>
</html>
