{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SPAC 2025 | Phase 01 Registration Form</title>
    <link rel="icon" href="{% static '/img/logo.gif' %}" />
    <!--daisy ui-->
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@5"
      rel="stylesheet"
      type="text/css"
    />
    <!--tailwind-->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- sweet alert  -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!--particles.js-->
    <script src="{% static 'js/particles.min.js' %}"></script>
    <!-- stats.js lib -->
    <script src="http://threejs.org/examples/js/libs/stats.min.js"></script>

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Instrument+Sans:ital,wght@0,400..700;1,400..700&display=swap');

      body {
        /* background-image: url("{% static '/img/StepBG.png' %}"); */
        background: transparent;
        background-repeat: no-repeat;
        background-size: cover;
        position: relative;
        z-index: 0;
        font-family: "Instrument Sans", sans-serif;
      }
      .response_count {
        /* font-weight: bold; */
        font-size: larger;
        border-bottom: 2px solid #19508e;
        border-top: 1px solid #19508e;
        border-left: 8px solid #19508e;
        border-right: 1px solid #19508e;
        padding: 4px 8px;
        border-radius: 4px;
        background: #c6e8ff;
        color: #122812;
        /* font-style: italic; */
      }
      /* Width of the scrollbar */
      .custom-scrollbar::-webkit-scrollbar {
        width: 5px;
        height: 12px; /* For horizontal scrollbar */
      }

      /* Track (background) */
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #a32d2d;
        border-radius: 8px;
      }

      /* Handle (the draggable part) */
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #e53232;
        border-radius: 9999px;
        cursor: pointer;
      }

      /* Handle on hover */
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #00629B;
      }
      /* particles container */
      canvas {
        display: block;
        vertical-align: bottom;
      } /* ---- particles.js container ---- */
      #particles-js {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: #002855;
        background-image: url("");
        background-repeat: no-repeat;
        background-size: 20%;
        background-position: 50% 50%;
      } /* ---- stats.js ---- */
      .count-particles {
        background: #000022;
        position: absolute;
        top: 48px;
        left: 0;
        width: 80px;
        color: #13e8e9;
        font-size: 0.8em;
        text-align: left;
        text-indent: 4px;
        line-height: 14px;
        padding-bottom: 2px;
        font-family: Helvetica, Arial, sans-serif;
        font-weight: bold;
      }
      .js-count-particles {
        font-size: 1.1em;
      }
      #stats,
      .count-particles {
        -webkit-user-select: none;
        margin-top: 5px;
        margin-left: 5px;
      }
      #stats {
        border-radius: 3px 3px 0 0;
        overflow: hidden;
      }
      .count-particles {
        border-radius: 0 0 3px 3px;
      }
      .input_label{
        display: block;
        font-size: 18px;
        margin-bottom: 0.35rem;
        color: #122812;
      }
      .input{
        width: 100%;
        padding: .5rem .75rem;
        border: 1px solid gray;
        border-radius: 0.375rem;
        outline-style: none;
        transition: all .3s ease-in-out;
        background: transparent;
      }
      .input:focus{
        border: 1px solid #00629B;
        box-shadow: 2px 2px 2px #bfdff5;
      }
      .continue-btn{
        color: white;
        background: #00629B;
        padding: 0.5rem 1.25rem;
        border-radius: 0.375rem;
        cursor: pointer;
        border: 1px solid #00629B;
      }
      .continue-btn:hover{
        background: #d3e4f7;
        color: #00629B;
        transition: 0.3s all ease-in-out;
      }
      .admin-btn{
        color: #122812;
        border: 1px solid #122812;
        border-radius: 0.325rem;
        background: #00629B;
        padding: 0.25rem 0.85rem;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        font-size: 1.25rem;
        transition: all 0.3s ease-in-out;
        justify-content: center;
        color: white;
      }
      .admin-btn:hover{
        background: #d3e4f7;
        color: #00629B;
      }
      .back-btn{
        color: #122812;
        border-radius: 1rem;
        cursor: pointer;
        font-size: 1.25rem;
        margin-top: .75rem;
      }
      .section_heading{
        text-align: center;
        font-size: 1.5rem;
        margin-bottom: .5rem;
        margin-bottom: 22px;
      }
      @media screen and (max-width: 500px) {
        .response_count {
          margin: 0 auto;
        }
        .admin-btn{
          width: 100%;
          font-size: 1rem;
        }
        .response_count{
          margin: 12px auto;
        }
      }
    </style>
  </head>

  <body class="py-2 custom-scrollbar min-h-screen">
    <!--Particles JS-->
    <div id="particles-js" class="fixed inset-0 -z-10"></div>

    <div class="w-11/12 md:w-3/5 mx-auto my-4">
      <div class="rounded overflow-hidden shadow-[0px_0px_10px_#00629B] border-1 border-white flex justify-center max-md:h-40">
        {% if not is_staff_view and not is_published and not registration_closed %}
        <img
          src="{% static '/img/phase1.png' %}"
          alt=""
          class="object-cover md:h-auto"
        />
        {% else %}
        <img
          src="{% static '/img/phase1.png' %}"
          alt=""
          class="object-cover md:h-auto"
        />
        {% endif %}
      </div>
    </div>
    {% if has_perm.reg_form_control %}
    <!-- admin feature part  -->
    <!-- Button Header -->
    <div class="rounded">
      <div
        class="bg-[#d3e4f7] w-11/12 md:w-3/5 mx-auto px-6 py-5"
        style="
          backdrop-filter: blur(7px);
          border-radius: 4px 4px;
          box-shadow: 0 2px 6px 0px #00000078;
          position: relative;
          top: 14px;"
      >
        <!-- <div class="flex flex-wrap gap-3 items-center justify-between"> -->
        <div
          class="flex flex-col sm:flex-row sm:flex-wrap items-center md:justify-between items-start"
        >
          <div>
            <!-- Publish Form Toggle Button (staff only) -->
            <button
              id="publishToggle"
              type="button"
              class="inline-flex gap-2 px-0 py-2.5 rounded-md font-medium text-lg"
            >
              <input
                id="publishCheckbox"
                type="checkbox"
                {% if is_published %} checked="checked"
                {% endif %}
                class="toggle border-gray-300 bg-gray-400 checked:border-[#00629B] checked:bg-[#D7F5BF] checked:text-[#00629B]"
              />
              {% if is_published %}
              <span
                class="text-xl"
                style="color: #00629B"
                id="publishText"
                >Form published!</span
              >
              {% else %}
              <span
                class="text-xl"
                style="color: rgb(207, 25, 18)"
                id="publishText"
                >Publish Form?</span
              >
              {% endif %}
            </button>
          </div>
          <p class="response_count">
            Response Count:
            <span style="font-weight: bold">{{registration_count}}</span>
          </p>
        </div>
        <div
          class="flex flex-col sm:flex-row gap-3 items-center justify-center sm:justify-center w-full sm:w-auto my-3"
        >
          <!-- Download Excel Button (staff only) -->
          <a
            href="{% url 'registration:download_excel' %}"
            class="admin-btn"
          >
            <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
              <path
                d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"
              />
            </svg>
            <span>Download Excel Sheet</span>
          </a>

          {% if has_perm.view_qr_dashboard %}
          <a
            href="{% url 'core:dashboard' %}"
            class="admin-btn"
          >
            <span>Dashboard</span>
          </a>
          {% endif %} 
          {% if has_perm.view_reg_responses_list %}
          <!-- See Responses Button (staff only) -->
          <a
            href="{% url 'registration:response_table' %}"
            class="admin-btn"
          >
            <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
              <path
                d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19M17,17H7V15H17V17M17,13H7V11H17V13M17,9H7V7H17V9Z"
              />
            </svg>
            <span>See Responses</span>
          </a>
          {% endif %}
        </div>
        {% endif %}
      </div>

      <div
        class="bg-[#d3e4f7] w-11/12 md:w-3/5 mx-auto"
        style="
          backdrop-filter: blur(7px);
          border-radius: 4px 4px;
          box-shadow: 0 2px 6px 0px #00000078;
        "
      >
        {% if not is_staff_view and not is_published and not registration_closed%}
        <div
          class="p-6 bg-yellow-50 border border-yellow-300 rounded text-yellow-900 text-center" style="
          margin-top:18px"
        >
          <p>
            Registration has not started yet. Please check back later.
          </p>
          {% comment %} <p>
            Registration is closed as we have reached the maximum number of
            participants.
          </p> {% endcomment %}
          <p>
            For any queries, contact - <a href="tel:+8801712902722" style="color:#0b5ed7;text-decoration:none;">+880 17 1290 2722</a>
          </p>
        </div>
        {% elif not is_staff_view and registration_closed %}
        <div
          class="p-6 bg-red-50 border border-red-300 rounded text-red-900 text-center"
        >
          Registration is closed as we have reached the maximum number of
          participants.
        </div>
        {% else %}
        <!-- Step indicator
        <div class="flex justify-between mb-8">
          <div id="step1Indicator" class="w-1/3 text-center font-bold text-primary">1. Basic Info</div>
          <div id="step2Indicator" class="w-1/3 text-center text-gray-500">2. Questionnaire</div>
          <div id="step3Indicator" class="w-1/3 text-center text-gray-500">3. Payment</div>
        </div> -->

        <!-- Form wrapper -->
        <form id="registrationForm" method="post" action="/submit-form/">
          {% csrf_token %}

          <!-- Step 1: Basic Info -->
          <section id="step1" class="shadow-md p-5 font-medium rounded-md">
            <h2 class="md:text-3xl text-xl text-center mb-5">
              Phase 01 - Participants Registration -  Student Professional Awareness Conference (SPAC) 2025
            </h2>
            <p class="text-justify">
              The IEEE North South University Student Branch is delighted to announce the opening of Phase 1 registration of the most-awaited flagship event of the year -  <b>Student Professional Awareness Conference (SPAC) 2025!</b> Phase 1 is your opportunity to secure your spot by expressing your interest in joining this dynamic experience.
              <br>
              <br>
              </p>
              <p >
              <b>What is Phase 1?</b>
              </p>
              <br>
              Phase 1 is an application-based selection process that is evaluated through the responses and answers you provide during registration.
              <br>
              <br>
              <b>What Phase 1 Offers:</b>
            </p>
              <ul class="list-disc ml-5">
                <li>Submit your detailed information and demonstrate your enthusiasm to secure your place.</li>
                <li>Receive early access to event updates and details, as Phase 1 is available on a first-come, first-served basis.</li>
              </ul>
              <br>
              <p class="text-justify">
              Participants selected after reviewing Phase 1 responses will only be able to register for Phase 2, which is the payment stage that completes the registration process. Please make sure to fill out all the questionnaire sections in detail and accurately, as it will be considered during the selection process.
              <br>
              <br>
              Secure your spot by registering soon!
              <br>
              <br>
              <b>Registration Deadline: 15th December, 2025</b>
              <br>
              <br>
            </p>
            <hr class="my-6 w-[100%] m-auto text-gray-400">
            <h2 class="section_heading">BASIC INFO</h2>
            <div class="mb-5">
              <label for="name" class="input_label">
                Name<span
                  class="text-red-700 ml-1"
                  >*</span
                >
              </label>
              <input
                type="text"
                name="name"
                id="name"
                placeholder="Enter your Name"
                class="input"
                required
              />
            </div>
            <div class="mb-5">
              <label for="email" class="input_label">
                Email Address<span class="text-red-700 ml-1">*</span>
              </label>
              <input
                type="email"
                name="email"
                id="email"
                placeholder="Enter your Email"
                class="input"
                required
              />
            </div>
            <div class="mb-5">
              <label for="contact_number" class="input_label">
                Contact Number<span class="text-red-700 ml-1">*</span>
              </label>
              <input
                type="number"
                name="contact_number"
                id="contact_number"
                placeholder="Enter your Contact Number"
                class="input"
                required
              />
            </div>
            <!--Select if you are a student or not-->
            <div class="mb-5">
              <label class="input_label">
                Are you a student from North South University?<span class="text-red-700 ml-1">*</span>
              </label>
              <label class="text-lg">
                <input
                  class="mb-1"
                  type="radio"
                  name="is_student"
                  value="student"
                  required
                />
                Yes </label
              ><br />
              <label class="text-lg">
                <input
                  class="mb-1"
                  type="radio"
                  name="is_student"
                  value="other_student"
                />
                Other</label
              ><br />
              <input
                type="hidden"
                name="is_student_bool"
                id="is_student_bool"
              />
            </div>
            <!--For Student-->
            <div class="student_div">
              <div class="mb-5">
                <label for="nsu_id" class="input_label">
                  Student ID<span class="text-red-700 ml-1">*</span>
                </label>
                <input
                  type="number"
                  name="nsu_id"
                  id="nsu_id"
                  placeholder="Enter your student id"
                  class="input"
                  required
                />
              </div>
              <div class="mb-5">
                <label for="department" class="input_label">
                  Department/Major<span class="text-red-700 ml-1">*</span>
                </label>
                <input
                  type="text"
                  name="department"
                  id="department"
                  placeholder="Enter your department/major"
                  class="input"
                  required
                />
              </div>
            </div>
            <!--For Students of other universities-->
            <div class="other_uni_div">
              <div class="mb-5">
                <label for="uni_name" class="input_label">
                  Institution Name<span class="text-red-700 ml-1">*</span>
                </label>
                <input
                  type="text"
                  name="uni_name"
                  id="uni_name"
                  placeholder="Enter your institution name"
                  class="input"
                  required
                />
              </div>
              <div class="mb-5">
                <label for="uni_id" class="input_label">
                  Student ID<span class="text-red-700 ml-1">*</span>
                </label>
                <input
                  type="number"
                  name="uni_id"
                  id="uni_id"
                  placeholder="Enter your student id"
                  class="input"
                  required
                />
              </div>
              <div class="mb-5">
                <label for="major" class="input_label">
                  Department/Major<span
                    class="text-red-700 ml-1"
                    >*</span
                  >
                </label>
                <input
                  type="text"
                  name="major"
                  id="major"
                  placeholder="Enter your department/major"
                  class="input"
                  required
                />
              </div>
            </div>
            <div class="mb-5">
              <label class="input_label">
                Are you an IEEE Member?<span class="text-red-700 ml-1">*</span>
              </label>
              <label class="text-lg">
                <input
                  class="mb-2"
                  type="radio"
                  name="membership_type"
                  value="member"
                  required
                />
                IEEE Member </label
              ><br />
              <label class="text-lg">
                <input type="radio" name="membership_type" value="non_ieee" />
                Non-IEEE Member </label
              ><br />
            </div>
            <div class="mb-5 ieee_id_div">
                <label for="ieee_id" class="input_label">
                  Your IEEE Membership ID<span
                    class="text-red-700 ml-1"
                    >*</span
                  >
                </label>
                <input
                  type="text"
                  name="ieee_id"
                  id="ieee_id"
                  placeholder="Enter your IEEE Membership ID"
                  class="input"
                  required
                />
            </div>
            <div class="mb-5">
              <label for="ambassador_code" class="input_label">
                Reference (Ambassador Unique Code)
              </label>
              <input
                type="text"
                name="ambassador_code"
                id="ambassador_code"
                placeholder="Enter the ambassador reference code"
                class="input"
              />
            </div>

            <div class="flex justify-center">
              <button
                onclick="nextStep(1)"
                class="continue-btn"
                type="button"
              >
                Continue
              </button>
            </div>
          </section>

          <!-- Step 2: Questionnaire -->
          <section
            id="step2"
            class="hidden shadow-md p-5 font-medium rounded-md"
          >
            <div class="flex items-center justify-between">
              <!-- Back button on the left -->
              <div class="z-10">
                <button
                  onclick="prevStep(1)"
                  class="back-btn"
                  type="button"
                >
                  Back
                </button>
              </div>

              <!-- Centered Questionnaire Section -->
              <div
                class="absolute left-1/2 transform -translate-x-1/2 px-20 sm:px-4"
              >
            </div>
          </div>
          <h2 class="section_heading">
            Questions
          </h2>

          <div class="mb-5">
            <label for="question1" class="input_label">
              1. What do you know about SPAC?<span class="text-red-700 ml-1">*</span>
            </label>
              <textarea
                id="question1"
                name="question1"
                maxlength="250"
                rows="4"
                class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
                placeholder="Type your answer here..."
                required
              ></textarea>
          </div>

          <div class="mb-5">
            <label for="question2" class="input_label">
              2. Why do you want to be a participant of SPAC?<span class="text-red-700 ml-1">*</span>
            </label>
            <textarea
              id="question2"
              name="question2"
              maxlength="250"
              rows="4"
              class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
              placeholder="Type your answer here..."
              required
            ></textarea>
          </div>

          <div class="mb-5">
            <label for="question3" class="input_label">
              3. What is your expectation from SPAC?<span class="text-red-700 ml-1">*</span>
            </label>
            <textarea
              id="question3"
              name="question3"
              maxlength="250"
              rows="4"
              class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
              placeholder="Type your answer here..."
              required
            ></textarea>
          </div>

          <div class="mb-5">
            <label for="comments" class="input_label">
              4. Any comments?
            </label>
            <textarea
              id="comments"
              name="comments"
              rows="3"
              class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
              placeholder="Optional..."
            ></textarea>
          </div>

            <div class="flex justify-center">
              <button
                class="continue-btn"
                type="submit"
              >
                Submit
              </button>
            </div>
          </section>
        </form>
        {% endif %}
      </div>
    </div>

    {% if is_staff_view %}
    <div
      id="publishModal"
      class="fixed inset-0 hidden bg-black/20 backdrop-blur-sm flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-xl shadow-lg w-96 p-6 text-center">
        <h2 class="text-xl font-semibold mb-4">Confirm Publish</h2>
        <p class="text-gray-600 mb-6">
          Are you sure you want to publish this form? Once published, it will be
          available for users to fill.
        </p>
        <div class="flex justify-center gap-4">
          <button
            id="cancelPublish"
            class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400"
          >
            Cancel
          </button>
          <button
            id="confirmPublish"
            class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700"
          >
            Yes, Publish
          </button>
        </div>
      </div>
    </div>

    <!-- Unpublish Confirmation Modal -->
    <div
      id="unpublishModal"
      class="fixed inset-0 hidden bg-black/20 backdrop-blur-sm flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-xl shadow-lg w-96 p-6 text-center">
        <h2 class="text-xl font-semibold mb-4">Confirm Unpublish</h2>
        <p class="text-gray-600 mb-6">
          Are you sure you want to unpublish this form? Users will no longer be
          able to fill it.
        </p>
        <div class="flex justify-center gap-4">
          <button
            id="cancelUnpublish"
            class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400"
          >
            Cancel
          </button>
          <button
            id="confirmUnpublish"
            class="px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700"
          >
            Yes, Unpublish
          </button>
        </div>
      </div>
    </div>
    {% endif %}

    <div class="flex justify-center items-center mt-3 h-15 mx-5 text-center sticky top-140 ">
      <p class="text-white font-semibold italic">
        <small>2025 Â© All rights reserved by IEEE NSU Student Branch</small>
      </p>
    </div>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const studentRadio = document.querySelector('input[name="is_student"][value="student"]');
  const otherStudentRadio = document.querySelector('input[name="is_student"][value="other_student"]');
  const studentDivs = document.querySelectorAll('.student_div');
  const otherStudentDivs = document.querySelectorAll('.other_uni_div');

  // --- IEEE Member Logic ---
  const ieeeMemberRadio = document.querySelector('input[name="membership_type"][value="member"]');
  const ieeeNonMemberRadio = document.querySelector('input[name="membership_type"][value="non_ieee"]');
  const ieeeIdDiv = document.querySelector('.ieee_id_div');
  const ieeeIdInput = document.querySelector('#ieee_id');

  function toggleIeeeSection() {
    if (ieeeMemberRadio.checked) {
      ieeeIdDiv.style.display = 'block';
      ieeeIdInput.required = true;
    } else if (ieeeNonMemberRadio.checked) {
      ieeeIdDiv.style.display = 'none';
      ieeeIdInput.required = false;
      ieeeIdInput.value = ""; // clear
    }
  }

  // --- Toggle Student Sections ---
  function toggleSections() {
    if (studentRadio.checked) {
      studentDivs.forEach(div => div.style.display = 'block');
      otherStudentDivs.forEach(div => div.style.display = 'none');

      document.querySelectorAll('.student_div input').forEach(f => f.required = true);
      document.querySelectorAll('.other_uni_div input').forEach(f => f.required = false);

    } else if (otherStudentRadio.checked) {
      studentDivs.forEach(div => div.style.display = 'none');
      otherStudentDivs.forEach(div => div.style.display = 'block');

      document.querySelectorAll('.student_div input').forEach(f => f.required = false);
      document.querySelectorAll('.other_uni_div input').forEach(f => f.required = true);
    }
  }

  // --- Default Hidden ---
  studentDivs.forEach(div => div.style.display = 'none');
  otherStudentDivs.forEach(div => div.style.display = 'none');
  ieeeIdDiv.style.display = 'none'; // hide IEEE ID by default

  // --- Event Listeners ---
  studentRadio.addEventListener('change', toggleSections);
  otherStudentRadio.addEventListener('change', toggleSections);

  ieeeMemberRadio.addEventListener('change', toggleIeeeSection);
  ieeeNonMemberRadio.addEventListener('change', toggleIeeeSection);
});


function nextStep(currentStep) {
  // Validate current step before moving forward
  if (!validateStep(currentStep)) {
    Swal.fire("Please fill in all the required fields!");
    return;
  }

  // If we're on step 1, go to step 2
  if (currentStep === 1) {
    goToStep(2);
    return;
  }
}


function prevStep(currentStep) {
  if (currentStep === 2) {
    goToStep(1);
  } else {
    goToStep(Math.max(1, currentStep - 1));
  }
}


function goToStep(stepNumber) {
  document.querySelectorAll("section[id^='step']").forEach(sec => sec.classList.add("hidden"));
  const nextSection = document.getElementById(`step${stepNumber}`);
  if (nextSection) nextSection.classList.remove("hidden");
  updateIndicators(stepNumber);
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function validateStep(stepNumber) {
  const currentStep = document.getElementById(`step${stepNumber}`);
  if (!currentStep) return true;
  const requiredFields = currentStep.querySelectorAll("[required]");
  
  let isValid = true;

  requiredFields.forEach(field => {
    let fieldWrapper = field.closest("div");

    if (field.type === 'radio') {
      // Get all radio buttons with the same name
      const radioGroup = currentStep.querySelectorAll(`[name="${field.name}"]`);
      
      // Check if at least one radio is selected
      const isChecked = Array.from(radioGroup).some(radio => (radio.checked && !radio.disabled));

      if (!isChecked) {
        isValid = false;
        radioGroup.forEach(radio => {
          const wrapper = radio.closest('label') || radio;
          wrapper.style.color = "#b02424ff";
        });
      } else {
        radioGroup.forEach(radio => {
          const wrapper = radio.closest('label') || radio;
          wrapper.style.color = "";
        });
      }
    } else if (!field.value.trim()) {
      isValid = false;
      field.style.border = "1px solid #f13131";
    } else {
      field.style.border = "";
    }
  });
  
  return isValid;
}

function updateIndicators(step) {
  if (!document.getElementById('step1Indicator')) return;
  [1, 2, 3, 4].forEach(num => {
    const indicator = document.getElementById(`step${num}Indicator`);
    if (indicator) {
      indicator.classList.remove("text-primary", "font-bold");
      indicator.classList.add("text-gray-500");
    }
  });
  const active = document.getElementById(`step${step}Indicator`);
  if (active) {
    active.classList.remove("text-gray-500");
    active.classList.add("text-primary", "font-bold");
  }
}


// --- Form Submission ---
document.getElementById('registrationForm').addEventListener('submit', function (e) {
  e.preventDefault();

  const submitBtn = document.querySelector('button[type="submit"]');
  const originalText = submitBtn.textContent;
  submitBtn.textContent = 'Submitting...';
  submitBtn.disabled = true;

  const formData = new FormData(this);
  fetch(this.action, {
    method: 'POST',
    body: formData,
    headers: { 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value || '' }
  })
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        Swal.fire({
          title: "Registration Complete ðŸŽŠ",
          text: "Thanks for signing up! Check your confirmation email (Inbox/Spam).",
          icon: "success"
        });
        this.reset();
        goToStep(1);
      } else {
        Swal.fire("Registration failed!", data.message, "error");
      }
    })
    .catch(err => Swal.fire("Error", err.message, "error"))
    .finally(() => {
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
});

{% if is_staff_view %}
// Get elements
const publishToggle = document.getElementById('publishCheckbox');
const publishText = document.getElementById('publishText');
const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

if (publishToggle) {
  publishToggle.addEventListener('change', () => {
    if (publishToggle.checked) {
      // Show Publish Modal
      document.getElementById('publishModal').classList.remove('hidden');
    } else {
      // Show Unpublish Modal
      document.getElementById('unpublishModal').classList.remove('hidden');
    }
  });

  // --- Publish Modal ---
  document.getElementById('cancelPublish').addEventListener('click', () => {
    document.getElementById('publishModal').classList.add('hidden');
    publishToggle.checked = false; // revert toggle
  });

  document.getElementById('confirmPublish').addEventListener('click', () => {
    document.getElementById('publishModal').classList.add('hidden');
    // Send AJAX request to publish
    fetch('{% url "registration:toggle_publish" %}', {
      method: 'POST',
      headers: {
        'X-CSRFToken': csrfToken
      }
    })
    .then(r => r.json())
    .then(data => {
      publishText.textContent = data.is_published ? 'Form published!' : 'Publish Form?';
      publishText.style.color = data.is_published ? '#009b1f' : '#cf1912';
      // alert('Publish status: ' + (data.is_published ? 'Published' : 'Unpublished'));
    })
    .catch(err => alert('Failed to toggle publish: ' + err.message));
  });

  // --- Unpublish Modal ---
  document.getElementById('cancelUnpublish').addEventListener('click', () => {
    document.getElementById('unpublishModal').classList.add('hidden');
    publishToggle.checked = true; // revert toggle
  });

  document.getElementById('confirmUnpublish').addEventListener('click', () => {
    document.getElementById('unpublishModal').classList.add('hidden');
    // Send AJAX request to unpublish
    fetch('{% url "registration:toggle_publish" %}', {
      method: 'POST',
      headers: {
        'X-CSRFToken': csrfToken
      }
    })
    .then(r => r.json())
    .then(data => {
      publishText.textContent = data.is_published ? 'Form published!' : 'Publish Form?';
      publishText.style.color = data.is_published ? '#009b1f' : '#cf1912';
      // alert('Publish status: ' + (data.is_published ? 'Published' : 'Unpublished'));
    })
    .catch(err => alert('Failed to toggle publish: ' + err.message));
  });
}
{% endif %}
</script>


    <script>
      document.addEventListener("DOMContentLoaded", function () {
        particlesJS("particles-js", {
          particles: {
            number: { value: 80, density: { enable: true, value_area: 800 } },
            color: { value: "#ffffff" },
            shape: {
              type: "circle",
              stroke: { width: 0, color: "#000000" },
              polygon: { nb_sides: 5 },
              image: { src: "img/github.svg", width: 100, height: 100 },
            },
            opacity: {
              value: 1,
              random: true,
              anim: { enable: true, speed: 1, opacity_min: 0, sync: false },
            },
            size: {
              value: 3,
              random: true,
              anim: { enable: false, speed: 4, size_min: 0.3, sync: false },
            },
            line_linked: {
              enable: true,
              distance: 150,
              color: "#ffffff",
              opacity: 0.4,
              width: 1,
            },
            move: {
              enable: true,
              speed: 1,
              direction: "none",
              random: true,
              straight: false,
              out_mode: "out",
              bounce: false,
              attract: { enable: false, rotateX: 600, rotateY: 600 },
            },
          },
          interactivity: {
            detect_on: "canvas",
            events: {
              onhover: { enable: false, mode: "bubble" },
              onclick: { enable: false, mode: "repulse" },
              resize: true,
            },
            modes: {
              grab: { distance: 400, line_linked: { opacity: 1 } },
              bubble: {
                distance: 250,
                size: 0,
                duration: 2,
                opacity: 0,
                speed: 3,
              },
              repulse: { distance: 400, duration: 0.4 },
              push: { particles_nb: 4 },
              remove: { particles_nb: 2 },
            },
          },
          retina_detect: true,
        });
        var count_particles, stats, update;
        stats = new Stats();
        stats.setMode(0);
        stats.domElement.style.position = "absolute";
        stats.domElement.style.left = "0px";
        stats.domElement.style.top = "0px";
        document.body.appendChild(stats.domElement);
        count_particles = document.querySelector(".js-count-particles");
        update = function () {
          stats.begin();
          stats.end();
          if (
            window.pJSDom[0].pJS.particles &&
            window.pJSDom[0].pJS.particles.array
          ) {
            count_particles.innerText =
              window.pJSDom[0].pJS.particles.array.length;
          }
          requestAnimationFrame(update);
        };
        requestAnimationFrame(update);
      });
    </script>
    <script>
      document.querySelectorAll('input[name="is_student"]').forEach((radio) => {
        radio.addEventListener("change", function () {
          document.getElementById("is_student_bool").value =
            this.value === "student" ? "True" : "False";
        });
      });
    </script>
  </body>
</html>
