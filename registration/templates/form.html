{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Power Express 2.0 | Registration Form</title>
    <link rel="icon" href="{% static '/img/logo.gif' %}" />
    <!--daisy ui-->
    <link
      href="https://cdn.jsdelivr.net/npm/daisyui@5"
      rel="stylesheet"
      type="text/css"
    />
    <!--tailwind-->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- sweet alert  -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <!--particles.js-->
    <script src="{% static 'js/particles.min.js' %}"></script>
    <!-- stats.js lib -->
    <script src="http://threejs.org/examples/js/libs/stats.min.js"></script>

    <style>
      body {
        /* background-image: url("{% static '/img/StepBG.png' %}"); */
        background: transparent;
        background-repeat: no-repeat;
        background-size: cover;
        position: relative;
        z-index: 0;
        font-family: "Inter", sans-serif;
      }
      .response_count {
        /* font-weight: bold; */
        font-size: larger;
        border-bottom: 2px solid #00629b;
        border-right: 2px solid #00629b;
        padding: 4px 8px;
        border-radius: 8px;
        background: #dceffa;
        color: #00629b;
        /* font-style: italic; */
      }
      @media screen and (max-width: 500px) {
        .response_count {
          margin: 0 auto;
        }
      }
      /* Width of the scrollbar */
      ::-webkit-scrollbar {
        width: 12px;
        height: 12px; /* For horizontal scrollbar */
      }

      /* Track (background) */
      ::-webkit-scrollbar-track {
        background: #a32d2d;
        border-radius: 8px;
      }

      /* Handle (the draggable part) */
      ::-webkit-scrollbar-thumb {
        background: #e53232;
        border-radius: 8px;
        border: 3px solid #9d1e1e; /* Padding effect */
      }

      /* Handle on hover */
      ::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      /* particles container */
      canvas {
        display: block;
        vertical-align: bottom;
      } /* ---- particles.js container ---- */
      #particles-js {
        position: absolute;
        width: 100%;
        height: 100%;
        background-color: #489a46;
        background-image: url("");
        background-repeat: no-repeat;
        background-size: 20%;
        background-position: 50% 50%;
      } /* ---- stats.js ---- */
      .count-particles {
        background: #000022;
        position: absolute;
        top: 48px;
        left: 0;
        width: 80px;
        color: #13e8e9;
        font-size: 0.8em;
        text-align: left;
        text-indent: 4px;
        line-height: 14px;
        padding-bottom: 2px;
        font-family: Helvetica, Arial, sans-serif;
        font-weight: bold;
      }
      .js-count-particles {
        font-size: 1.1em;
      }
      #stats,
      .count-particles {
        -webkit-user-select: none;
        margin-top: 5px;
        margin-left: 5px;
      }
      #stats {
        border-radius: 3px 3px 0 0;
        overflow: hidden;
      }
      .count-particles {
        border-radius: 0 0 3px 3px;
      }
    </style>
  </head>

  <body class="min-h-screen py-8">
    <!--Particles JS-->
    <div id="particles-js" class="fixed inset-0 -z-10"></div>

    <div class="w-11/12 md:w-3/5 mx-auto my-4 mt-12">
      <div class="rounded overflow-hidden shadow-lg flex justify-center">
        {% if not is_staff_view and not is_published and not registration_closed %}
        <img
          style="height: 70vh"
          src="{% static '/img/PowerExpressBanner.png' %}"
          alt=""
          class="object-cover h-auto max-h-screen"
        />
        {% else %}
        <img
          src="{% static '/img/PowerExpressBanner.png' %}"
          alt=""
          class="object-cover h-auto"
        />
        {% endif %}
      </div>
    </div>
    {% if has_perm.reg_form_control %}
    <!-- admin feature part  -->
    <!-- Button Header -->
    <div class="rounded">
      <div
        class="bg-white w-11/12 md:w-3/5 mx-auto px-6 py-5"
        style="
          backdrop-filter: blur(7px);
          border-radius: 4px 4px;
          box-shadow: 0 2px 6px 0px #00000078;
          position: relative;
          top: 14px;"
      >
        <!-- <div class="flex flex-wrap gap-3 items-center justify-between"> -->
        <div
          class="flex flex-col sm:flex-row sm:flex-wrap items-center justify-between"
        >
          <div>
            <!-- Publish Form Toggle Button (staff only) -->
            <button
              id="publishToggle"
              type="button"
              class="inline-flex items-center gap-2 px-0 py-2.5 rounded-md font-medium text-lg"
            >
              <input
                id="publishCheckbox"
                type="checkbox"
                {%
                if
                is_published
                %}checked="checked"
                {%
                endif
                %}
                class="toggle border-gray-300 bg-gray-400 checked:border-blue-500 checked:bg-blue-400 checked:text-blue-800"
              />
              {% if is_published %}
              <span
                class="text-xl"
                style="color: rgb(0, 155, 31)"
                id="publishText"
                >Form published!</span
              >
              {% else %}
              <span
                class="text-xl"
                style="color: rgb(207, 25, 18)"
                id="publishText"
                >Publish Form?</span
              >
              {% endif %}
            </button>
          </div>
          <p class="response_count">
            Response Count:
            <span style="font-weight: bold">{{registration_count}}</span>
          </p>
        </div>
        <div
          class="flex flex-col sm:flex-row gap-3 items-center justify-center sm:justify-center w-full sm:w-auto my-3"
        >
          <!-- Download Excel Button (staff only) -->
          <a
            href="{% url 'registration:download_excel' %}"
            class="inline-flex items-center justify-center gap-2 px-5 py-2.5 w-64 sm:w-auto max-sm:my-1 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-md font-medium text-lg transition-all duration-200 transform hover:scale-105 hover:from-emerald-600 hover:to-emerald-700 hover:shadow-lg focus:outline-none focus:ring-emerald-500 focus:ring-offset-2"
          >
            <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
              <path
                d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"
              />
            </svg>
            <span>Download Excel Sheet</span>
          </a>

          {% if has_perm.view_qr_dashboard %}
          <a
            href="{% url 'core:dashboard' %}"
            class="inline-flex items-center gap-2 px-5 py-2.5 w-64 sm:w-auto max-sm:my-1 bg-gradient-to-r from-amber-500 to-amber-600 text-white rounded-md font-medium text-lg transition-all duration-200 transform hover:scale-105 hover:from-amber-600 hover:to-amber-700 hover:shadow-lg focus:outline-none focus:ring-emerald-500 focus:ring-offset-2"
          >
            <span>Dashboard</span>
          </a>
          {% endif %} 
          {% if has_perm.view_reg_responses_list %}
          <!-- See Responses Button (staff only) -->
          <a
            href="{% url 'registration:response_table' %}"
            class="inline-flex items-center gap-2 px-5 py-2.5 w-64 sm:w-auto max-sm:my-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-md font-medium text-lg transition-all duration-200 transform hover:scale-105 hover:from-blue-600 hover:to-blue-700 hover:shadow-lg focus:outline-none focus:ring-blue-500 focus:ring-offset-2"
          >
            <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
              <path
                d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19M17,17H7V15H17V17M17,13H7V11H17V13M17,9H7V7H17V9Z"
              />
            </svg>
            <span>See Responses</span>
          </a>
          <a
            href="{% url 'registration:t_shirt_responses' %}"
            class="inline-flex items-center gap-2 px-5 py-2.5 w-64 sm:w-auto max-sm:my-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-md font-medium text-lg transition-all duration-200 transform hover:scale-105 hover:from-blue-600 hover:to-blue-700 hover:shadow-lg focus:outline-none focus:ring-blue-500 focus:ring-offset-2"
          >
            <svg class="w-4 h-4 fill-current" viewBox="0 0 24 24">
              <path
                d="M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3M19,19H5V5H19V19M17,17H7V15H17V17M17,13H7V11H17V13M17,9H7V7H17V9Z"
              />
            </svg>
            <span>See T-Shirt Responses</span>
          </a>
          {% endif %}
        </div>
        {% endif %}
      </div>

      <div
        class="bg-white w-11/12 md:w-3/5 mx-auto"
        style="
          backdrop-filter: blur(7px);
          border-radius: 4px 4px;
          box-shadow: 0 2px 6px 0px #00000078;
        "
      >
        {% if not is_staff_view and not is_published and not registration_closed%}
        <div
          class="p-6 bg-yellow-50 border border-yellow-300 rounded text-yellow-900 text-center"
        >
          {% comment %} 
          Registration is not open yet. Please check back later.
          {% endcomment %}
          <p>
            The form Power Express 2.0 is no longer accepting responses.
          </p>
          <p>
            Try contacting the owner of the form if you think this is a mistake.
          </p>
        </div>
        {% elif not is_staff_view and registration_closed %}
        <div
          class="p-6 bg-red-50 border border-red-300 rounded text-red-900 text-center"
        >
          Registration is closed as we have reached the maximum number of
          participants.
        </div>
        {% else %}
        <!-- Step indicator
        <div class="flex justify-between mb-8">
          <div id="step1Indicator" class="w-1/3 text-center font-bold text-primary">1. Basic Info</div>
          <div id="step2Indicator" class="w-1/3 text-center text-gray-500">2. Questionnaire</div>
          <div id="step3Indicator" class="w-1/3 text-center text-gray-500">3. Payment</div>
        </div> -->

        <!-- Form wrapper -->
        <form id="registrationForm" method="post" action="/submit-form/">
          {% csrf_token %}

          <!-- Step 1: Basic Info -->
          <section id="step1" class="shadow-md p-5 font-medium rounded-md">
            <h2 class="text-2xl text-center mb-5">
              Power Express 2.0
            </h2>
            <p class="text-justify">
              As global energy demands rise and climate challenges grow, the need for efficient grid design and sustainable energy management has never been greater. For Bangladesh, ensuring reliable power, integrating renewables, and maintaining grid stability are vital for sustainable growth. To address these challenges, PowerExpress aims to create a collaborative platform that fosters innovation, research, and practical solutions in the energy sector.  
              <br>
              <br>
              <b>PowerExpress</b>, a flagship event from the <b>IEEE NSU PES Student Branch Chapter</b> brings together students, young professionals, industry leaders, and policy leaders for a day-long program of learning, innovation, and collaboration.  The program features a series of inspiring keynote talks, impactful panel discussions, and interactive competitions designed to turn fresh ideas into real-world solutions.
              <br>
              <br>
              The event concludes with a Closing & Awards Ceremony, which will inspire and celebrate innovation and collaboration. More than an event, <b>PowerExpress</b> is a platform that connects academia, industry, and young innovators, empowering participants to actively contribute to a sustainable energy future.
              <br>
              <br>
              Event Details: 
              <br>
              <br>
              <b>Event Name</b>: PowerExpress 2.0
              <br>
              <b>Organized by</b>: IEEE NSU PES Student Branch Chapter
              <br>
              <b>Event Date</b>: 24th November 2025
              <br>
              <b>Venue</b>: North South University, Dhaka
              <br>
              <b>Event Type</b>: Day-long flagship program
            </p>
            <hr class="my-6 w-[98%] m-auto text-gray-400">
            <h2 class="text-center text-2xl">BASIC INFO</h2>
            <div class="mb-5">
              <label for="name" class="block uppercase text-lg mb-1">
                Name<span
                  class="text-red-500"
                  >*</span
                >
              </label>
              <input
                type="text"
                name="name"
                id="name"
                placeholder="Enter your Name"
                class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                required
              />
            </div>
            <div class="mb-5">
              <label for="email" class="block uppercase text-lg mb-1">
                Email Address<span class="text-red-500">*</span>
              </label>
              <input
                type="email"
                name="email"
                id="email"
                placeholder="Enter your Email"
                class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                required
              />
            </div>
            <div class="mb-5">
              <label for="contact_number" class="block uppercase text-lg mb-1">
                Contact Number<span class="text-red-500">*</span>
              </label>
              <input
                type="number"
                name="contact_number"
                id="contact_number"
                placeholder="Enter your Contact Number"
                class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                required
              />
            </div>
            <!--Select if you are a student or not-->
            <div class="mb-5">
              <label class="block uppercase text-lg mb-1">
                Are you a student from North South University?<span class="text-red-500">*</span>
              </label>
              <label>
                <input
                  class="mb-1 text-md"
                  type="radio"
                  name="is_student"
                  value="student"
                  required
                />
                Yes </label
              ><br />
              <label>
                <input
                  class="mb-1 text-md"
                  type="radio"
                  name="is_student"
                  value="other_student"
                />
                Other</label
              ><br />
              <input
                type="hidden"
                name="is_student_bool"
                id="is_student_bool"
              />
            </div>
            <!--For Student-->
            <div class="student_div">
              <div class="mb-5">
                <label for="nsu_id" class="block uppercase text-lg mb-1">
                  NSU ID<span class="text-red-500">*</span>
                </label>
                <input
                  type="number"
                  name="nsu_id"
                  id="nsu_id"
                  placeholder="Enter your NSU ID"
                  class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                  required
                />
              </div>
              <div class="mb-5">
                <label for="nsu_email" class="block uppercase text-lg mb-1">
                  NSU Email<span class="text-red-500">*</span>
                </label>
                <input
                  type="email"
                  name="nsu_email"
                  id="nsu_email"
                  placeholder="Enter your NSU email"
                  class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                  required
                />
              </div>
              <div class="mb-5">
                <label for="department" class="block uppercase text-lg mb-1">
                  Department<span class="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  name="department"
                  id="department"
                  placeholder="Enter your department"
                  class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                  required
                />
              </div>
              <div class="mb-5">
                <label for="current_year" class="block uppercase text-lg mb-1">
                  Which year are you in?<span class="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  name="current_year"
                  id="current_year"
                  placeholder="Enter your current year in univerisity"
                  class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                  required
                />
              </div>
            </div>
            <!--For Students of other universities-->
            <div class="other_uni_div">
              <div class="mb-5">
                <label for="uni_name" class="block uppercase text-lg mb-1">
                  Name of your university<span class="text-red-500">*</span>
                </label>
                <input
                  type="text"
                  name="uni_name"
                  id="uni_name"
                  placeholder="Enter your university name"
                  class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                  required
                />
              </div>
              <div class="mb-5">
                <label for="uni_id" class="block uppercase text-lg mb-1">
                  University ID<span class="text-red-500">*</span>
                </label>
                <input
                  type="number"
                  name="uni_id"
                  id="uni_id"
                  placeholder="Enter your university id"
                  class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                  required
                />
              </div>
              <div class="mb-5">
                <label for="other_current_year" class="block uppercase text-lg mb-1">
                  Which year are you in?<span
                    class="text-red-500"
                    >*</span
                  >
                </label>
                <input
                  type="text"
                  name="other_current_year"
                  id="other_current_year"
                  placeholder="Enter your current year in univerisity"
                  class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                  required
                />
              </div>
              <div class="mb-5">
                <label for="major" class="block uppercase text-lg mb-1">
                  What's your major?<span
                    class="text-red-500"
                    >*</span
                  >
                </label>
                <input
                  type="text"
                  name="major"
                  id="major"
                  placeholder="Enter your major"
                  class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                  required
                />
              </div>
            </div>
            <div class="mb-5">
              <label class="block uppercase text-lg mb-1">
                Are you an IEEE Member?<span class="text-red-500">*</span>
              </label>
              <label>
                <input
                  class="mb-1"
                  type="radio"
                  name="membership_type"
                  value="member"
                  required
                />
                IEEE Member </label
              ><br />
              <label>
                <input type="radio" name="membership_type" value="non_ieee" />
                Non-IEEE Member </label
              ><br />
            </div>
            <div class="mb-5">
                <label for="ieee_id" class="block uppercase text-lg mb-1">
                  Your IEEE ID Number (Write N/A if you're Non-IEEE Member)<span
                    class="text-red-500"
                    >*</span
                  >
                </label>
                <input
                  type="text"
                  name="ieee_id"
                  id="ieee_id"
                  placeholder="Enter your Membership ID"
                  class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                  required
                />
            </div>
            <div class="flex justify-center">
              <button
                onclick="nextStep(1)"
                class="text-[#74BA2D] bg-[#D7F5BF] px-5 py-2 rounded-md hover:bg-[#c4f49d] duration-300 transition-all ease-in-out cursor-pointer"
                type="button"
              >
                Continue
              </button>
            </div>
          </section>

          <!-- Step 2: Questionnaire -->
          <section
            id="step2"
            class="hidden shadow-md p-5 font-medium rounded-md"
          >
            <div class="flex items-center justify-between mb-8">
              <!-- Back button on the left -->
              <div class="z-10">
                <button
                  onclick="prevStep(1)"
                  class="rounded-2xl px-2 text-[#00629b] cursor-pointer mb-6"
                  type="button"
                >
                  Back
                </button>
              </div>

              <!-- Centered Questionnaire Section -->
              <div
                class="absolute left-1/2 transform -translate-x-1/2 px-20 sm:px-4"
              >
                <h2 class="text-2xl mb-6 truncate text-center">
                  QUESTIONNAIRE
                </h2>
              </div>
            </div>

            <div class="mb-5">
              <label for="question1" class="block uppercase text-lg mb-1">
                1. What's your idea about this event?(Write your thoughts within 100 words)<span
                  class="text-red-500"
                  >*</span
                >
              </label>
              <textarea
                id="question1"
                name="question1"
                maxlength="250"
                rows="4"
                class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
                placeholder="Type your answer here..."
                required
              ></textarea>
            </div>
            <div class="mb-5">
              <label for="question2" class="block uppercase text-lg mb-1">
                2. What is your expectation from this program? (Write your thoughts within 100 words)<span
                  class="text-red-500"
                  >*</span
                >
              </label>
              <textarea
                id="question2"
                name="question2"
                maxlength="250"
                rows="4"
                class="w-full p-2 border border-gray-500 rounded-md focus:outline-none focus:ring-1 focus:ring-black"
                placeholder="Type your answer here..."
                required
              ></textarea>
            </div>
            <div class="mb-5">
              <label for="ambassador_code" class="block uppercase text-lg mb-1">
                Ambassador Code<span
                  class="text-red-500"
                  >*</span
                >
              </label>
              <input
                type="text"
                name="ambassador_code"
                id="ambassador_code"
                placeholder="Enter your major"
                class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                required
              />
            </div>
             <div class="mb-5">
              <label class="block uppercase text-lg mb-1">
                You are joining "Power Express 2.0" as_<span class="text-red-500">*</span>
              </label>
              <label>
                <input
                  class="mb-1"
                  type="radio"
                  name="participant_type"
                  value="participant"
                  required
                />
                Just as Participant</label
              ><br />
              <label>
                <input
                  class="mb-1"
                  type="radio"
                  name="participant_type"
                  value="poster"
                />
                Participant and Poster Presentation Contestant</label
              ><br />
              <label>
                <input
                  class="mb-1"
                  type="radio"
                  name="participant_type"
                  value="olympiad"
                />
                Participant and Power Olympiad Contestant</label
              ><br />
              
            </div>
            <div class="flex justify-center">
              <button
                onclick="nextStep(2)"
                class="text-[#74BA2D] bg-[#D7F5BF] px-5 py-2 rounded-md hover:bg-[#c4f49d] duration-300 transition-all ease-in-out cursor-pointer"
                type="button"
              >
                Continue
              </button>
            </div>
          </section>
          <!-- Step 3: Poster Contest-->
           <section
            id="step3"
            class="hidden shadow-md p-5 font-medium rounded-md"
          >
            <div class="flex items-center justify-between mb-8">
              <!-- Back button on the left -->
              <div class="z-10">
                <button
                  onclick="prevStep(2)"
                  class="rounded-2xl px-2 text-[#00629b] cursor-pointer mb-6"
                  type="button"
                >
                  Back
                </button>
              </div>

              <div
                class="absolute left-1/2 transform -translate-x-1/2 px-20 sm:px-4"
              >
                <p class="text-justify">Each team can have 3 members (maximum). All of the members will have to register for the event. Only one member from each team will have to register for his team.</p>
              </div>
            </div>
             <div class="mb-5">
              <label class="block uppercase text-lg mb-1">
                Are you registering for your team?<span class="text-red-500">*</span>
              </label>
              <label>
                <input
                  class="mb-1"
                  type="radio"
                  name="registering_for_team"
                  value="yes"
                  required
                />
                Yes, I'm registering for my team.</label
              ><br />
              <label>
                <input
                  class="mb-1"
                  type="radio"
                  name="registering_for_team"
                  value="no"
                />
                No, one of my teammate will register.</label
              ><br />
            </div>
            <div class="mb-5" id="team_count_section">
              <label class="block uppercase text-lg mb-1">
                How many member are there in your team?<span class="text-red-500">*</span>
              </label>
              <label>
                <input
                  class="mb-1"
                  type="radio"
                  name="team_mem_count"
                  value="2"
                  required
                />
                2</label
              ><br />
              <label>
                <input
                  class="mb-1"
                  type="radio"
                  name="team_mem_count"
                  value="3"
                />
                3</label
              ><br />
            </div>
            <div id="mem_1">
              <div class="mb-5">
                <label for="mem_name_1" class="block uppercase text-lg mb-1">
                  Name of your team member 1<span class="text-red-500">*</span>
                </label>
                <input
                type="text"
                name="mem_name_1"
                id="mem_name_1"
                placeholder="Enter your team member name"
                class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                required
                />
            </div>
            <div class="mb-5">
              <label for="mem_uni_name_1" class="block uppercase text-lg mb-1">
                University Name<span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                name="mem_uni_name_1"
                id="mem_uni_name_1"
                placeholder="Enter your university id"
                class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                required
                />
              </div>
              <div class="mb-5">
                <label for="mem_uni_id_1" class="block uppercase text-lg mb-1">
                University ID<span
                  class="text-red-500"
                  >*</span
                >
              </label>
              <input
              type="text"
              name="mem_uni_id_1"
              id="mem_uni_id_1"
              placeholder="Enter your current year in univerisity"
              class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
              required
              />
            </div>
            </div>
            <div id="mem_2">
              <div class="mb-5">
                <label for="mem_name_2" class="block uppercase text-lg mb-1">
                  Name of your team member 2<span class="text-red-500">*</span>
                </label>
                <input
                type="text"
                name="mem_name_2"
                id="mem_name_2"
                placeholder="Enter your university name"
                class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                required
                />
            </div>
            <div class="mb-5">
              <label for="mem_uni_name_2" class="block uppercase text-lg mb-1">
                University Name<span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                name="mem_uni_name_2"
                id="mem_uni_name_2"
                placeholder="Enter your university id"
                class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                required
                />
              </div>
              <div class="mb-5">
                <label for="mem_uni_id_2" class="block uppercase text-lg mb-1">
                University ID<span
                  class="text-red-500"
                  >*</span
                >
              </label>
              <input
              type="text"
              name="mem_uni_id_2"
              id="mem_uni_id_2"
              placeholder="Enter your current year in univerisity"
              class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
              required
              />
            </div>
            </div>
            <div class="flex justify-center">
              <button
                onclick="nextStep(3)"
                class="text-[#74BA2D] bg-[#D7F5BF] px-5 py-2 rounded-md hover:bg-[#c4f49d] duration-300 transition-all ease-in-out cursor-pointer"
                type="button"
              >
                Continue
              </button>
            </div>
          </section>

          <!-- Step 4: Payment -->
          <section
            id="step4"
            class="hidden shadow-md p-5 font-medium rounded-md"
          >
            <!--  back button and title  -->
            <div class="flex items-center justify-between mb-8">
              <!-- Back button on the left -->
              <div class="z-10">
                <button
                  onclick="prevStep(3)"
                  class="rounded-2xl px-2 text-[#00629b] cursor-pointer mb-6"
                  type="button"
                >
                  Back
                </button>
              </div>
              <div
                class="absolute left-1/2 transform -translate-x-1/2 px-20 sm:px-4"
              >
                <h2 class="text-2xl mb-6 truncate text-center">PAYMENT</h2>
              </div>
            </div>
            <p>
              IEEE Member 400 taka <br />
              Non-IEEE Member 500 taka
              <br />
              <br />
              <span style="font-weight: bold">Bkash: +8801734973058</span>
            </p>
            <div class="my-8">
              <label class="block uppercase mb-1">
                Select Payment Method:<span class="text-red-500">*</span>
              </label>
              <label>
                <input
                  type="radio"
                  name="payment_method"
                  value="Bkash"
                  required
                />
                Bkash (Send Money)
              </label>
            </div>

            <div class="mb-5">
              <label for="transaction_id" class="block uppercase mb-1">
                Transaction ID<span class="text-red-500">*</span>
              </label>
              <input
                type="text"
                name="transaction_id"
                id="transaction_id"
                placeholder="Enter your Transaction ID"
                class="w-full px-3 py-2 border border-gray-500 rounded-md focus:outline-none"
                required
              />
            </div>

            {% comment %}
            <!-- shirt table  -->
            <h2 class="mb-1">Size Chart</h2>

            <div class="overflow-x-auto">
              <table
                class="w-full border-collapse text-xs sm:text-lg min-w-full bg-gray-50"
              >
                <thead>
                  <tr>
                    <th
                      class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-left font-semibold text-gray-700"
                    >
                      Description
                    </th>
                    <th
                      class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700"
                    >
                      S
                    </th>
                    <th
                      class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700"
                    >
                      M
                    </th>
                    <th
                      class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700"
                    >
                      L
                    </th>
                    <th
                      class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700"
                    >
                      XL
                    </th>
                    <th
                      class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700"
                    >
                      2XL
                    </th>
                    <th
                      class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 text-center font-semibold text-gray-700"
                    >
                      3XL
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <tr class="hover:bg-gray-50">
                    <td
                      class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 font-semibold text-gray-700"
                    >
                      Chest Width
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      36"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      38"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      40"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      42"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      44"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      46"
                    </td>
                  </tr>
                  <tr class="hover:bg-gray-50">
                    <td
                      class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 font-semibold text-gray-700"
                    >
                      Chest Height
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      25"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      26"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      27"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      28"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      29"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      30"
                    </td>
                  </tr>
                  <tr class="hover:bg-gray-50">
                    <td
                      class="border border-gray-300 bg-gray-50 px-2 py-2 sm:px-3 font-semibold text-gray-700"
                    >
                      Body Length
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      26"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      27"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      28"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      29"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      30"
                    </td>
                    <td
                      class="border border-gray-300 px-2 py-2 sm:px-3 text-center"
                    >
                      31"
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="mb-4 mt-3">
              <label class="block uppercase mb-1">
                Select T-Shirt size<span class="text-red-500">*</span>
              </label>
              <div class="flex flex-col gap-2 ml-6">
                <label class="flex items-center gap-2">
                  <input
                    type="radio"
                    name="tshirt_size"
                    value="S"
                    class="form-radio text-blue-500"
                    required
                  />
                  S
                </label>
                <label class="flex items-center gap-2">
                  <input
                    type="radio"
                    name="tshirt_size"
                    value="M"
                    class="form-radio text-blue-500"
                    required
                  />
                  M
                </label>
                <label class="flex items-center gap-2">
                  <input
                    type="radio"
                    name="tshirt_size"
                    value="L"
                    class="form-radio text-blue-500"
                    required
                  />
                  L
                </label>
                <label class="flex items-center gap-2">
                  <input
                    type="radio"
                    name="tshirt_size"
                    value="XL"
                    class="form-radio text-blue-500"
                    required
                  />
                  XL
                </label>
                <label class="flex items-center gap-2">
                  <input
                    type="radio"
                    name="tshirt_size"
                    value="2XL"
                    class="form-radio text-blue-500"
                    required
                  />
                  2XL
                </label>
                <label class="flex items-center gap-2">
                  <input
                    type="radio"
                    name="tshirt_size"
                    value="3XL"
                    class="form-radio text-blue-500"
                    required
                  />
                  3XL
                </label>
              </div>
            </div>
            {% endcomment %}
            <div class="flex justify-center">
              <button
                type="submit"
                class="text-[#74BA2D] bg-[#D7F5BF] px-5 py-2 rounded-md hover:bg-[#c4f49d] duration-300 ease-in-out transition-all"
              >
                Submit
              </button>
            </div>
          </section>
        </form>
        {% endif %}
      </div>
    </div>

    {% if is_staff_view %}
    <div
      id="publishModal"
      class="fixed inset-0 hidden bg-black/20 backdrop-blur-sm flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-xl shadow-lg w-96 p-6 text-center">
        <h2 class="text-xl font-semibold mb-4">Confirm Publish</h2>
        <p class="text-gray-600 mb-6">
          Are you sure you want to publish this form? Once published, it will be
          available for users to fill.
        </p>
        <div class="flex justify-center gap-4">
          <button
            id="cancelPublish"
            class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400"
          >
            Cancel
          </button>
          <button
            id="confirmPublish"
            class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700"
          >
            Yes, Publish
          </button>
        </div>
      </div>
    </div>

    <!-- Unpublish Confirmation Modal -->
    <div
      id="unpublishModal"
      class="fixed inset-0 hidden bg-black/20 backdrop-blur-sm flex items-center justify-center z-50"
    >
      <div class="bg-white rounded-xl shadow-lg w-96 p-6 text-center">
        <h2 class="text-xl font-semibold mb-4">Confirm Unpublish</h2>
        <p class="text-gray-600 mb-6">
          Are you sure you want to unpublish this form? Users will no longer be
          able to fill it.
        </p>
        <div class="flex justify-center gap-4">
          <button
            id="cancelUnpublish"
            class="px-4 py-2 rounded bg-gray-300 hover:bg-gray-400"
          >
            Cancel
          </button>
          <button
            id="confirmUnpublish"
            class="px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700"
          >
            Yes, Unpublish
          </button>
        </div>
      </div>
    </div>
    {% endif %}

    <div class="flex justify-center items-center mt-3 h-15">
      <p class="text-white">
        <small>2025 Â© All rights reserved by IEEE NSU Student Branch</small>
      </p>
    </div>
<script>
document.addEventListener('DOMContentLoaded', function () {
  const studentRadio = document.querySelector('input[name="is_student"][value="student"]');
  const otherStudentRadio = document.querySelector('input[name="is_student"][value="other_student"]');
  const studentDivs = document.querySelectorAll('.student_div');
  const otherStudentDivs = document.querySelectorAll('.other_uni_div');

  const teamRadios = document.querySelectorAll('input[name="registering_for_team"]');
  const teamCountSection = document.getElementById("team_count_section");
  const teamCountRadios = document.querySelectorAll('input[name="team_mem_count"]');
  const mem1 = document.getElementById("mem_1");
  const mem2 = document.getElementById("mem_2");

  // --- Toggle Student Sections ---
  function toggleSections() {
    if (studentRadio.checked) {
      studentDivs.forEach(div => div.style.display = 'block');
      otherStudentDivs.forEach(div => div.style.display = 'none');

      document.querySelectorAll('.student_div input').forEach(f => f.required = true);
      document.querySelectorAll('.other_uni_div input').forEach(f => f.required = false);

    } else if (otherStudentRadio.checked) {
      studentDivs.forEach(div => div.style.display = 'none');
      otherStudentDivs.forEach(div => div.style.display = 'block');

      document.querySelectorAll('.student_div input').forEach(f => f.required = false);
      document.querySelectorAll('.other_uni_div input').forEach(f => f.required = true);
    }
  }

  studentDivs.forEach(div => div.style.display = 'none');
  otherStudentDivs.forEach(div => div.style.display = 'none');
  studentRadio.addEventListener('change', toggleSections);
  otherStudentRadio.addEventListener('change', toggleSections);

  // --- Toggle Team Sections ---
  function toggleTeamSection() {
    const selected = document.querySelector('input[name="registering_for_team"]:checked');
    if (selected && selected.value === "yes") {
      teamCountSection.style.display = "block";
    } else {
      teamCountSection.style.display = "none";
      mem1.style.display = "none";
      mem2.style.display = "none";
    }
  }

  function toggleMemberSection() {
    const selected = document.querySelector('input[name="team_mem_count"]:checked');
    if (!selected) return;
    mem1.style.display = selected.value === "2" || selected.value === "3" ? "block" : "none";
    mem2.style.display = selected.value === "3" ? "block" : "none";
  }

  teamRadios.forEach(r => r.addEventListener("change", toggleTeamSection));
  teamCountRadios.forEach(r => r.addEventListener("change", toggleMemberSection));
  toggleTeamSection();
  toggleMemberSection();
});


// --- Step Navigation Logic ---
let lastStepBeforePayment = 2; // Tracks what came before step 4

function nextStep(currentStep) {
  if (!validateStep(currentStep)) {
    Swal.fire("Please fill in all the required fields!");
    return;
  }

  if (currentStep === 2) {
    const participantType = document.querySelector('input[name="participant_type"]:checked');
    if (!participantType) {
      Swal.fire("Please select a participation type!");
      return;
    }

    if (participantType.value === "poster") {
      lastStepBeforePayment = 3;
      goToStep(3);
    } else {
      lastStepBeforePayment = 2;
      goToStep(4);
    }
    return;
  }

  if (currentStep === 3) {
    lastStepBeforePayment = 3;
  }

  goToStep(currentStep + 1);
}

function prevStep(currentStep) {
  if (currentStep === 3) {
    goToStep(lastStepBeforePayment);
  } else if (currentStep === 2){
    goToStep(2);
  } else {
    goToStep(currentStep - 1);
  }
}

function goToStep(stepNumber) {
  document.querySelectorAll("section[id^='step']").forEach(sec => sec.classList.add("hidden"));
  const nextSection = document.getElementById(`step${stepNumber}`);
  if (nextSection) nextSection.classList.remove("hidden");
  updateIndicators(stepNumber);
  window.scrollTo({ top: 0, behavior: "smooth" });
}

function validateStep(stepNumber) {
  const currentStep = document.getElementById(`step${stepNumber}`);
  if (!currentStep) return true;
  const requiredInputs = currentStep.querySelectorAll("[required]");
  for (const input of requiredInputs) {
    if (!input.value.trim()) return false;
  }
  return true;
}

function updateIndicators(step) {
  if (!document.getElementById('step1Indicator')) return;
  [1, 2, 3, 4].forEach(num => {
    const indicator = document.getElementById(`step${num}Indicator`);
    if (indicator) {
      indicator.classList.remove("text-primary", "font-bold");
      indicator.classList.add("text-gray-500");
    }
  });
  const active = document.getElementById(`step${step}Indicator`);
  if (active) {
    active.classList.remove("text-gray-500");
    active.classList.add("text-primary", "font-bold");
  }
}


// --- Form Submission ---
document.getElementById('registrationForm').addEventListener('submit', function (e) {
  e.preventDefault();

  const submitBtn = document.querySelector('button[type="submit"]');
  const originalText = submitBtn.textContent;
  submitBtn.textContent = 'Submitting...';
  submitBtn.disabled = true;

  const formData = new FormData(this);
  fetch(this.action, {
    method: 'POST',
    body: formData,
    headers: { 'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value || '' }
  })
    .then(r => r.json())
    .then(data => {
      if (data.success) {
        Swal.fire({
          title: "Registration Complete ð",
          text: "Thanks for signing up! Check your confirmation email (Inbox/Spam).",
          icon: "success"
        });
        this.reset();
        goToStep(1);
      } else {
        Swal.fire("Registration failed!", data.message, "error");
      }
    })
    .catch(err => Swal.fire("Error", err.message, "error"))
    .finally(() => {
      submitBtn.textContent = originalText;
      submitBtn.disabled = false;
    });
});
</script>


    <script>
      document.addEventListener("DOMContentLoaded", function () {
        particlesJS("particles-js", {
          particles: {
            number: { value: 160, density: { enable: true, value_area: 800 } },
            color: { value: "#ffffff" },
            shape: {
              type: "circle",
              stroke: { width: 0, color: "#000000" },
              polygon: { nb_sides: 5 },
              image: { src: "img/github.svg", width: 100, height: 100 },
            },
            opacity: {
              value: 1,
              random: true,
              anim: { enable: true, speed: 1, opacity_min: 0, sync: false },
            },
            size: {
              value: 3,
              random: true,
              anim: { enable: false, speed: 4, size_min: 0.3, sync: false },
            },
            line_linked: {
              enable: false,
              distance: 150,
              color: "#ffffff",
              opacity: 0.4,
              width: 1,
            },
            move: {
              enable: true,
              speed: 1,
              direction: "none",
              random: true,
              straight: false,
              out_mode: "out",
              bounce: false,
              attract: { enable: false, rotateX: 600, rotateY: 600 },
            },
          },
          interactivity: {
            detect_on: "canvas",
            events: {
              onhover: { enable: false, mode: "bubble" },
              onclick: { enable: false, mode: "repulse" },
              resize: true,
            },
            modes: {
              grab: { distance: 400, line_linked: { opacity: 1 } },
              bubble: {
                distance: 250,
                size: 0,
                duration: 2,
                opacity: 0,
                speed: 3,
              },
              repulse: { distance: 400, duration: 0.4 },
              push: { particles_nb: 4 },
              remove: { particles_nb: 2 },
            },
          },
          retina_detect: true,
        });
        var count_particles, stats, update;
        stats = new Stats();
        stats.setMode(0);
        stats.domElement.style.position = "absolute";
        stats.domElement.style.left = "0px";
        stats.domElement.style.top = "0px";
        document.body.appendChild(stats.domElement);
        count_particles = document.querySelector(".js-count-particles");
        update = function () {
          stats.begin();
          stats.end();
          if (
            window.pJSDom[0].pJS.particles &&
            window.pJSDom[0].pJS.particles.array
          ) {
            count_particles.innerText =
              window.pJSDom[0].pJS.particles.array.length;
          }
          requestAnimationFrame(update);
        };
        requestAnimationFrame(update);
      });
    </script>
    <script>
      document.querySelectorAll('input[name="is_student"]').forEach((radio) => {
        radio.addEventListener("change", function () {
          document.getElementById("is_student_bool").value =
            this.value === "student" ? "True" : "False";
        });
      });
    </script>
  </body>
</html>
